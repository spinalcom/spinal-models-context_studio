"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
let Utilities = {};
const globalType = typeof window === "undefined" ? global : window;

Utilities.getViewer = function () {
  return new Promise((resolve, reject) => {
    if (globalType.v === "undefined") {
      let interval = setInterval(() => {
        if (globalType.v !== "undefined") {
          resolve(globalType.v);
          clearInterval(interval);
        }
      }, 500);
    } else resolve(globalType.v);
  });
};

Utilities.promiseGetProperties = function (_dbId) {
  return new Promise(resolve => {
    Utilities.getViewer().then(viewer => {
      viewer.getProperties(_dbId, resolve);
    });
  });
};

Utilities.promiseGetExternalIdMapping = function (_externalId) {
  return new Promise(resolve => {
    Utilities.getViewer().then(viewer => {
      viewer.model.getExternalIdMapping(res => {
        resolve(res[_externalId]);
      });
    });
  });
};

// Utilities.promiseLoad = function(_ptr) {
//   return new Promise(resolve => {
//     _ptr.load(resolve);
//   });
// }
Utilities.promiseLoad = function (_ptr) {
  if (_ptr instanceof globalType.Ptr && _ptr.data.value != 0 && typeof FileSystem._objects[_ptr.data.value] != "undefined") return Promise.resolve(FileSystem._objects[_ptr.data.value]);else return new Promise(resolve => {
    _ptr.load(resolve);
  });
};

Utilities.getExternalId = async function (_dbId) {
  let properties = await Utilities.promiseGetProperties(_dbId);
  return properties.externalId;
};

Utilities.getDbIdByExternalId = async function (_externalId) {
  let dbid = await Utilities.promiseGetExternalIdMapping(_externalId);
  return dbid;
};

Utilities.arraysEqual = function (arrayA, arrayB) {
  if (arrayA === arrayB) return true;
  if (arrayA == null || arrayB == null) return false;
  if (arrayA.length != arrayB.length) return false;
  arrayA.sort();
  arrayB.sort();
  for (var i = 0; i < arrayA.length; ++i) {
    if (arrayA[i] !== arrayB[i]) return false;
  }
  return true;
};

Utilities.containsLstById = function (_list, _node) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.id.get() == _node.id.get()) return true;
  }
  return false;
};

Utilities.containsLstModel = function (_list, _model) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.get() == _model.get()) return true;
  }
  return false;
};

Utilities.containsLst = function (_list, _element) {
  for (let index = 0; index < _list.length; index++) {
    const element = _list[index];
    if (element.get() == _element) return true;
  }
  return false;
};

Utilities.include = function (arr, obj) {
  return arr.indexOf(obj) != -1;
};

Utilities.getIndex = function (arr, obj) {
  return arr.indexOf(obj);
};

Utilities.getIds = function (array) {
  let res = [];
  for (let index = 0; index < array.length; index++) {
    res.push(array[index].id.get());
  }
  return res;
};
// Utilities.addNotExisting = function(arr, obj) {
//   return (arr.indexOf(obj));
// }

Utilities.concat = function (listA, listB) {
  let res = [];
  for (let index = 0; index < listA.length; index++) {
    res.push(listA[index]);
  }
  for (let index = 0; index < listB.length; index++) {
    res.push(listB[index]);
  }
  return res;
};

Utilities.allButMeById = function (_list, _node) {
  let res = [];
  for (let index = 0; index < _list.length; index++) {
    const node = _list[index];
    if (node.id.get() != _node.id.get()) {
      res.push(node);
    }
    return res;
  }
};

Utilities.guid = function (_constructor) {
  return _constructor + "-" + this.s4() + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + this.s4() + this.s4() + "-" + Date.now().toString(16);
};

Utilities.s4 = function () {
  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
};

Utilities.putOnTopLst = function (lst, elementB) {
  lst.remove_ref(elementB);
  lst.unshift(elementB);
  // for (let index = 0; index < lst.length; index++) {
  //   const element = lst[index];
  //   if (element.id.get() === elementB.id.get()) {
  //     lst.remove(index);
  //   }

  // }
};

exports.Utilities = Utilities;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9VdGlsaXRpZXMuanMiXSwibmFtZXMiOlsiVXRpbGl0aWVzIiwiZ2xvYmFsVHlwZSIsIndpbmRvdyIsImdsb2JhbCIsImdldFZpZXdlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidiIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwicHJvbWlzZUdldFByb3BlcnRpZXMiLCJfZGJJZCIsInRoZW4iLCJ2aWV3ZXIiLCJnZXRQcm9wZXJ0aWVzIiwicHJvbWlzZUdldEV4dGVybmFsSWRNYXBwaW5nIiwiX2V4dGVybmFsSWQiLCJtb2RlbCIsImdldEV4dGVybmFsSWRNYXBwaW5nIiwicmVzIiwicHJvbWlzZUxvYWQiLCJfcHRyIiwiUHRyIiwiZGF0YSIsInZhbHVlIiwiRmlsZVN5c3RlbSIsIl9vYmplY3RzIiwibG9hZCIsImdldEV4dGVybmFsSWQiLCJwcm9wZXJ0aWVzIiwiZXh0ZXJuYWxJZCIsImdldERiSWRCeUV4dGVybmFsSWQiLCJkYmlkIiwiYXJyYXlzRXF1YWwiLCJhcnJheUEiLCJhcnJheUIiLCJsZW5ndGgiLCJzb3J0IiwiaSIsImNvbnRhaW5zTHN0QnlJZCIsIl9saXN0IiwiX25vZGUiLCJpbmRleCIsImVsZW1lbnQiLCJpZCIsImdldCIsImNvbnRhaW5zTHN0TW9kZWwiLCJfbW9kZWwiLCJjb250YWluc0xzdCIsIl9lbGVtZW50IiwiaW5jbHVkZSIsImFyciIsIm9iaiIsImluZGV4T2YiLCJnZXRJbmRleCIsImdldElkcyIsImFycmF5IiwicHVzaCIsImNvbmNhdCIsImxpc3RBIiwibGlzdEIiLCJhbGxCdXRNZUJ5SWQiLCJub2RlIiwiZ3VpZCIsIl9jb25zdHJ1Y3RvciIsInM0IiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwic3Vic3RyaW5nIiwicHV0T25Ub3BMc3QiLCJsc3QiLCJlbGVtZW50QiIsInJlbW92ZV9yZWYiLCJ1bnNoaWZ0Il0sIm1h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VkQ7O1FBYUU3RSxTLEdBQUFBLFMiLCJmaWxlIjoiVXRpbGl0aWVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IFV0aWxpdGllcyA9IHt9O1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5cblV0aWxpdGllcy5nZXRWaWV3ZXIgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBpZiAoZ2xvYmFsVHlwZS52ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBsZXQgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGlmIChnbG9iYWxUeXBlLnYgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICByZXNvbHZlKGdsb2JhbFR5cGUudik7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDUwMCk7XG4gICAgfSBlbHNlIHJlc29sdmUoZ2xvYmFsVHlwZS52KTtcbiAgfSk7XG59O1xuXG5VdGlsaXRpZXMucHJvbWlzZUdldFByb3BlcnRpZXMgPSBmdW5jdGlvbihfZGJJZCkge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgVXRpbGl0aWVzLmdldFZpZXdlcigpLnRoZW4odmlld2VyID0+IHtcbiAgICAgIHZpZXdlci5nZXRQcm9wZXJ0aWVzKF9kYklkLCByZXNvbHZlKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5VdGlsaXRpZXMucHJvbWlzZUdldEV4dGVybmFsSWRNYXBwaW5nID0gZnVuY3Rpb24oX2V4dGVybmFsSWQpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIFV0aWxpdGllcy5nZXRWaWV3ZXIoKS50aGVuKHZpZXdlciA9PiB7XG4gICAgICB2aWV3ZXIubW9kZWwuZ2V0RXh0ZXJuYWxJZE1hcHBpbmcocmVzID0+IHtcbiAgICAgICAgcmVzb2x2ZShyZXNbX2V4dGVybmFsSWRdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxufVxuXG5cbi8vIFV0aWxpdGllcy5wcm9taXNlTG9hZCA9IGZ1bmN0aW9uKF9wdHIpIHtcbi8vICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuLy8gICAgIF9wdHIubG9hZChyZXNvbHZlKTtcbi8vICAgfSk7XG4vLyB9XG5VdGlsaXRpZXMucHJvbWlzZUxvYWQgPSBmdW5jdGlvbihfcHRyKSB7XG4gIGlmIChcbiAgICBfcHRyIGluc3RhbmNlb2YgZ2xvYmFsVHlwZS5QdHIgJiZcbiAgICBfcHRyLmRhdGEudmFsdWUgIT0gMCAmJlxuICAgIHR5cGVvZiBGaWxlU3lzdGVtLl9vYmplY3RzW19wdHIuZGF0YS52YWx1ZV0gIT0gXCJ1bmRlZmluZWRcIlxuICApXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShGaWxlU3lzdGVtLl9vYmplY3RzW19wdHIuZGF0YS52YWx1ZV0pO1xuICBlbHNlXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgX3B0ci5sb2FkKHJlc29sdmUpO1xuICAgIH0pO1xufTtcblxuXG5cblxuVXRpbGl0aWVzLmdldEV4dGVybmFsSWQgPSBhc3luYyBmdW5jdGlvbihfZGJJZCkge1xuICBsZXQgcHJvcGVydGllcyA9IGF3YWl0IFV0aWxpdGllcy5wcm9taXNlR2V0UHJvcGVydGllcyhfZGJJZCk7XG4gIHJldHVybiBwcm9wZXJ0aWVzLmV4dGVybmFsSWQ7XG59O1xuXG5VdGlsaXRpZXMuZ2V0RGJJZEJ5RXh0ZXJuYWxJZCA9IGFzeW5jIGZ1bmN0aW9uKF9leHRlcm5hbElkKSB7XG4gIGxldCBkYmlkID0gYXdhaXQgVXRpbGl0aWVzLnByb21pc2VHZXRFeHRlcm5hbElkTWFwcGluZyhfZXh0ZXJuYWxJZCk7XG4gIHJldHVybiBkYmlkO1xufTtcblxuVXRpbGl0aWVzLmFycmF5c0VxdWFsID0gZnVuY3Rpb24oYXJyYXlBLCBhcnJheUIpIHtcbiAgaWYgKGFycmF5QSA9PT0gYXJyYXlCKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKGFycmF5QSA9PSBudWxsIHx8IGFycmF5QiA9PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gIGlmIChhcnJheUEubGVuZ3RoICE9IGFycmF5Qi5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgYXJyYXlBLnNvcnQoKTtcbiAgYXJyYXlCLnNvcnQoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheUEubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoYXJyYXlBW2ldICE9PSBhcnJheUJbaV0pIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblV0aWxpdGllcy5jb250YWluc0xzdEJ5SWQgPSBmdW5jdGlvbihfbGlzdCwgX25vZGUpIHtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9saXN0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBfbGlzdFtpbmRleF07XG4gICAgaWYgKGVsZW1lbnQuaWQuZ2V0KCkgPT0gX25vZGUuaWQuZ2V0KCkpIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblV0aWxpdGllcy5jb250YWluc0xzdE1vZGVsID0gZnVuY3Rpb24oX2xpc3QsIF9tb2RlbCkge1xuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX2xpc3QubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IF9saXN0W2luZGV4XTtcbiAgICBpZiAoZWxlbWVudC5nZXQoKSA9PSBfbW9kZWwuZ2V0KCkpIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblV0aWxpdGllcy5jb250YWluc0xzdCA9IGZ1bmN0aW9uKF9saXN0LCBfZWxlbWVudCkge1xuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX2xpc3QubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3QgZWxlbWVudCA9IF9saXN0W2luZGV4XTtcbiAgICBpZiAoZWxlbWVudC5nZXQoKSA9PSBfZWxlbWVudCkgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuVXRpbGl0aWVzLmluY2x1ZGUgPSBmdW5jdGlvbihhcnIsIG9iaikge1xuICByZXR1cm4gYXJyLmluZGV4T2Yob2JqKSAhPSAtMTtcbn07XG5cblV0aWxpdGllcy5nZXRJbmRleCA9IGZ1bmN0aW9uKGFyciwgb2JqKSB7XG4gIHJldHVybiBhcnIuaW5kZXhPZihvYmopO1xufTtcblxuVXRpbGl0aWVzLmdldElkcyA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gIGxldCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGFycmF5Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHJlcy5wdXNoKGFycmF5W2luZGV4XS5pZC5nZXQoKSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG4vLyBVdGlsaXRpZXMuYWRkTm90RXhpc3RpbmcgPSBmdW5jdGlvbihhcnIsIG9iaikge1xuLy8gICByZXR1cm4gKGFyci5pbmRleE9mKG9iaikpO1xuLy8gfVxuXG5VdGlsaXRpZXMuY29uY2F0ID0gZnVuY3Rpb24obGlzdEEsIGxpc3RCKSB7XG4gIGxldCByZXMgPSBbXTtcbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxpc3RBLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHJlcy5wdXNoKGxpc3RBW2luZGV4XSk7XG4gIH1cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxpc3RCLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHJlcy5wdXNoKGxpc3RCW2luZGV4XSk7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cblV0aWxpdGllcy5hbGxCdXRNZUJ5SWQgPSBmdW5jdGlvbihfbGlzdCwgX25vZGUpIHtcbiAgbGV0IHJlcyA9IFtdO1xuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX2xpc3QubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3Qgbm9kZSA9IF9saXN0W2luZGV4XTtcbiAgICBpZiAobm9kZS5pZC5nZXQoKSAhPSBfbm9kZS5pZC5nZXQoKSkge1xuICAgICAgcmVzLnB1c2gobm9kZSk7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cbn07XG5cblV0aWxpdGllcy5ndWlkID0gZnVuY3Rpb24oX2NvbnN0cnVjdG9yKSB7XG4gIHJldHVybiAoXG4gICAgX2NvbnN0cnVjdG9yICtcbiAgICBcIi1cIiArXG4gICAgdGhpcy5zNCgpICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIFwiLVwiICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIFwiLVwiICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIFwiLVwiICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIFwiLVwiICtcbiAgICB0aGlzLnM0KCkgK1xuICAgIHRoaXMuczQoKSArXG4gICAgdGhpcy5zNCgpICtcbiAgICBcIi1cIiArXG4gICAgRGF0ZS5ub3coKS50b1N0cmluZygxNilcbiAgKTtcbn07XG5cblV0aWxpdGllcy5zNCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gTWF0aC5mbG9vcigoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMClcbiAgICAudG9TdHJpbmcoMTYpXG4gICAgLnN1YnN0cmluZygxKTtcbn07XG5cblV0aWxpdGllcy5wdXRPblRvcExzdCA9IGZ1bmN0aW9uKGxzdCwgZWxlbWVudEIpIHtcbiAgbHN0LnJlbW92ZV9yZWYoZWxlbWVudEIpO1xuICBsc3QudW5zaGlmdChlbGVtZW50Qik7XG4gIC8vIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsc3QubGVuZ3RoOyBpbmRleCsrKSB7XG4gIC8vICAgY29uc3QgZWxlbWVudCA9IGxzdFtpbmRleF07XG4gIC8vICAgaWYgKGVsZW1lbnQuaWQuZ2V0KCkgPT09IGVsZW1lbnRCLmlkLmdldCgpKSB7XG4gIC8vICAgICBsc3QucmVtb3ZlKGluZGV4KTtcbiAgLy8gICB9XG5cbiAgLy8gfVxufTtcblxuZXhwb3J0IHtcbiAgVXRpbGl0aWVzXG59OyJdfQ==